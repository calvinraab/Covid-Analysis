---
title: "Project1RMD"
author: "Group"
date: "4/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Here is where we can put our work. I imagine this is what we will turn in. 

Here I am uploading the original datasets: 
```{r}
library(readr)
library(dplyr)
library(leaps)
library(ggplot2)
library(reshape2)
library(scales)
library(corrplot)
library(car)

Fat_Supply_Quantity_Data <- read_csv("Fat_Supply_Quantity_Data.csv")
Food_Supply_Quantity_kg_Data <- read_csv("Food_Supply_Quantity_kg_Data.csv")
Food_Supply_kcal_Data <- read_csv("Food_Supply_kcal_Data.csv")
Protein_Supply_Quantity_Data <- read_csv("Protein_Supply_Quantity_Data.csv")
Supply_Food_Data_Descriptions <- read_csv("Supply_Food_Data_Descriptions.csv")
glimpse(Fat_Supply_Quantity_Data)
```

Data cleaning process. Here we can clean up that data and get it cleaned to the point where we will be able to work with it. 
```{r}
#select columns that are not filled with zeros
Fat_Supply_data <- Fat_Supply_Quantity_Data %>% select(Country, `Animal Products`, `Animal fats`, `Cereals - Excluding Beer`, Eggs, `Fish, Seafood`, `Fruits - Excluding Wine`, Meat, `Milk - Excluding Butter`, Offals, Oilcrops, Pulses, Spices, `Starchy Roots`, Stimulants, Treenuts, `Vegetal Products`, `Vegetable Oils`, Vegetables, Obesity, Undernourished, Population, Confirmed, Deaths)

Fat_Supply_data <- Fat_Supply_data[Fat_Supply_data$Deaths > 0,]
Fat_Supply_data <- Fat_Supply_data[!is.na(Fat_Supply_data$Deaths),]


Fat_Supply_data$Undernourished[Fat_Supply_data$Undernourished == "<2.5"] <- 2.5
Fat_Supply_data$Undernourished <- as.numeric(Fat_Supply_data$Undernourished)

data <- Fat_Supply_data

# Here is a dataset that includes the parameters found in backAIC, along with: Country, Population, Confirmed, and Deaths (Using For Analysis) 
backAICdata.plus <- data_frame(data$`Country`, data$`Animal fats`, data$`Cereals - Excluding Beer`, data$`Fruits - Excluding Wine`, data$`Oilcrops`, data$`Pulses`, data$`Spices`, data$`Starchy Roots`, data$Stimulants, data$Treenuts, data$`Vegetal Products`, data$`Vegetable Oils`, data$Vegetables, data$Obesity, data$Undernourished, data$Population, data$Confirmed, data$Deaths)

names(backAICdata.plus) <- c("Country", "Animal_Fats", "Cereals", "Fruits", "Oilcrops", "Pulses", "Spices", "Starchy_Roots", "Stimulants", "Treenuts", "Vegetal Products", "Vegetable_Oils", "Vegetables", "Obesity", "Undernourished", "Population", "Confirmed", "Deaths")

# replace NAs in Obesity and Undernourished with the median values
backAICdata.plus$Obesity[is.na(backAICdata.plus$Obesity)] <- median(backAICdata.plus$Obesity, na.rm=TRUE)
backAICdata.plus$Undernourished[is.na(backAICdata.plus$Undernourished)] <- median(backAICdata.plus$Undernourished, na.rm=TRUE)
```

### Part 1 
Provide a descriptive analysis of your variables. This should include histograms and fitted distributions, correlation plot, boxplots, scatterplots, and statistical summaries (e.g., the five-number summary). All figures must include comments.

Columns in dataset:  
* Fat Supply Measures - Average percentage (out of 100) of fat in diet that comes from each category of food
    - Categories included: Animal_Fats, Cereals, Fruits, Oilcrops, Pulses, Spices, Starchy_Roots, Stimulants, Treenuts, Vegetal Products, Vegetable_oils, and Vegetables
    
* Population Health Measures - Percentage of the population that falls into each category
    - Obesity and Undernourished
    
* Population and COVID Measures
    - Population - Population of country
    - Confirmed - Percentage of population with a confirmed positive test for COVID-19
    - Deaths - Percentage of population that died from COVID-19
    

```{r}
# create a boxplot of food categories


# melt the data into long form
fat_data <- melt(backAICdata.plus[,1:13], id = "Country")

# create boxplots
ggplot(fat_data, aes(x = variable, y = value)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(labels = label_percent(scale = 1)) +
  xlab("Food Category") +
  ylab("Percentage of Fat") +
  ggtitle("Boxplot of Percentage of Fat in Diet from Food Categories")
```

From the above boxplots, we can see that Vegetal Products and Vegetable Oils are major sources of fat for all countries, whike the average values for other categories are low. We can also see that Oilcrops has a relatively large amount of high outliers compared to other groups.  

```{r}
# correlation plot of all variables

corrplot(cor(backAICdata.plus[,-1]), method = "circle")
```

From the above correlation plot, we can see some interesting correlations between some food groups, such as between Vetegal Procucts and Animal Fats. We also see that Obesity and Undernourished are strongly negatively correlated, which makes sense, and that there is a very high correlation between Confirmed Cases and Deaths, which is also to be expected. 


```{r}
# five number summaries for each numeric column

apply(backAICdata.plus[,-1], 2, summary)


```


```{r}
library(ggplot2)
# Percentage of confirmed cases by country - I want to only post the labels of countries that have over a 5% confirmed case level 
ggplot(data = backAICdata.plus, aes(x=Country, y=Confirmed, label= Country)) + geom_point() + geom_text(check_overlap = TRUE) + scale_x_discrete(guide = guide_axis(check.overlap = TRUE))
```


### Part 2
Estimate a multiple linear regression model that includes all the main effects only (i.e., no interactions nor higher order terms). We will use this model as a baseline. Comment on the statistical and economic significance of your estimates. Also, make sure to provide an interpretation of your estimates.
```{r}

m1 <- lm(Deaths ~ ., data = Fat_Supply_data[,-c(1,23)])
summary(m1)




model_all <- lm(data$Deaths ~ data$`Animal Products` + data$`Animal fats` + data$`Cereals - Excluding Beer` + data$Eggs + data$`Fish, Seafood` + data$`Fruits - Excluding Wine` + data$Meat + data$`Milk - Excluding Butter` + data$Offals + data$Oilcrops + data$Pulses + data$Spices + data$`Starchy Roots` + data$Stimulants + data$Treenuts + data$`Vegetal Products` + data$`Vegetable Oils` + data$Vegetables + data$Obesity + data$Undernourished + data$Population)

summary(model_all)

n <- length(data$Deaths)

backAIC <- step(model_all ,direction="backward", data=data)
summary(backAIC)
backBIC <- step(model_all ,direction="backward", data=data, k = log(n))
```


### Part 3
Identify if there are any outliers, high leverage, and or influential observations worth removing. If so, remove them but justify your reason for doing so and re-estimate your model.
```{r}

# https://cran.r-project.org/web/packages/olsrr/vignettes/influence_measures.html

influencePlot(model_all, id=list(n=3)) 

install.packages("olsrr")
library(olsrr)

ols_plot_resid_lev(model_all)

```

### Part 4
Use Mallows Cp for identifying which terms you will keep in the model (based on part 3) and also use the Boruta algorithm for variable selection. Based on the two results, determine which subset of predictors you will keep.
```{r}
#Mallows CP **gets stuck loading

#ss = regsubsets(data$Deaths~.,really.big = T, method = c("exhaustive"), nbest = 1, data = backAICdata.plus)
#subsets(ss, statistic="cp", legend = F, main = "Mallows CP")

install.packages("Boruta")
library(Boruta)


Bor.res <- Boruta(data$Deaths~., data = backAICdata.plus, doTrace = 2 )
plot(Bor.res, xlab = "", xaxt = "n", main = "Boruta Algorithim")
lz<-lapply(1:ncol(Bor.res$ImpHistory),function(i)
Bor.res$ImpHistory[is.finite(Bor.res$ImpHistory[,i]),i])
names(lz) <- colnames(Bor.res$ImpHistory)
Labels <- sort(sapply(lz,median))
plot(Bor.res)
# Fix labels


```


### Part 5
Test for multicollinearity using VIF on the model from (4) . Based on the test, remove any appropriate variables, and estimate a new regression model based on these findings.
```{r}
vif(model_all) # We will remove any variable with a VIF over 5 to satisfy collinearity assumption


model_vif <- lm(data$Deaths ~  data$`Cereals - Excluding Beer` + data$Eggs + data$`Fish, Seafood` + data$`Fruits - Excluding Wine` + data$Meat + data$`Milk - Excluding Butter` + data$Offals + data$Oilcrops + data$Pulses + data$Spices + data$`Starchy Roots` + data$Stimulants + data$Treenuts + data$Vegetables + data$Obesity + data$Undernourished + data$Population)

vif(model_vif)

```


### Part 6
For your model in part (5) plot the respective residuals vs. y_hat  and comment on your results.
```{r}

```


### Part 7
For your model in part (5) perform a RESET test and comment on your results.
```{r}

```


### Part 8
For your model in part (5) test for heteroskedasticity and comment on your results. If you identify heteroskedasticy, make sure to account for it before moving on to (9).
```{r}

```


### Part 9
Estimate a model based on all your findings that also includes interaction terms (if appropriate) and if needed, any higher power terms. Comment on the performance of this model compared to your other models. Make sure to use AIC and BIC for model comparison.
```{r}

```

### Part 10
Evaluate your model performance (from 9) using cross-validation, and also by dividing your data into the traditional 2/3 training and 1/3 testing samples, to evaluate your out-of-sample performance. Comment on your results. 
```{r}

```


### Part 11
Provide a short (1 paragraph) summary of your overall conclusions/findings.


